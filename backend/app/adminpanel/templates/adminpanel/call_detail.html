{% load static %}
<!-- templates/adminpanel/call_detail.html -->
{% extends "adminpanel/base.html" %}
{% block layout %}
<div class="col-3 sidebar p-4">
  {% if forbidden %}
  <div class="alert alert-danger">ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.</div>
  {% elif not_found %}
  <div class="alert alert-warning">í†µí™”ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
  {% else %}
  <div class="text-center mb-3">
    <img src="{{ call.senior.profile_image_url }}" class="rounded-circle"
      style="width:120px;height:120px;object-fit:cover;background:#fff;">
  </div>
  <h4 class="fw-bold mb-1">{{ call.senior.name }}</h4>
  <div class="text-muted">ID: u_{{ call.senior.id }}</div>
  <div class="mt-3">
    <a class="btn btn-outline-secondary w-100" href="/adminpanel/seniors/{{ call.senior.id }}/">â† ëª©ë¡ìœ¼ë¡œ</a>
  </div>
  {% endif %}
</div>

<div class="col-9 p-4">
  {% if not forbidden and not not_found %}
  <div class="card p-3 mb-3">
    <div class="fw-bold">ğŸ”” í†µí™” ë¶„ì„ ê²°ê³¼ {% if call.ended_at %}({{ call.ended_at|date:"Y.m.d H:i" }}){% endif %}</div>
    <div class="mt-2 d-flex gap-2 flex-wrap">
      <span class="badge text-bg-light border">
        ìƒíƒœ:
        {% if analysis and analysis.status == "DANGER" %}ğŸ”´ ìœ„í—˜{% elif analysis and analysis.status == "WARNING" %}ğŸŸ 
        ì£¼ì˜{% else %}ğŸŸ¢ ì•ˆì „{% endif %}
      </span>
      <span class="badge text-bg-light border">ìœ í˜•: {{ analysis.category|default:"-" }}</span>
      <span class="badge text-bg-light border">ê´€ë ¨ í‚¤ì›Œë“œ: {{ analysis.keywords|default:"-" }}</span>
    </div>
  </div>

  <div class="card p-3" style="max-height:70vh; overflow:auto;">
    <div class="fw-bold mb-2">ğŸ“œ ì „ì²´ í†µí™” ë‚´ìš©</div>
    <hr />
    {% for ln in lines %}
    <div class="mb-2">
      <span class="text-muted small me-2">[{{ ln.ts }}]</span>
      <span class="fw-semibold">{{ ln.speaker }}:</span>
      <span>{{ ln.text }}</span>
    </div>
    {% endfor %}
  </div>
  {% endif %}
</div>
{% endblock %}